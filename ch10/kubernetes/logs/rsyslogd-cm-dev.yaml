kind: ConfigMap
apiVersion: v1
metadata:
  name: rsyslog-config-development
  namespace: example
data:
  rsyslogd.conf: |-
    #################
    #### MODULES ####
    #################
    
    # module(load="imuxsock") # provides support for local system logging
    # module(load="imklog")   # provides kernel logging support
    module(load="immark")  # provides --MARK-- message capability
    
    # provides TCP syslog reception
    module(load="imtcp")
    input(type="imtcp" port="514")
    module(load="imudp")
    input(type="imudp" port="514")
    
    ###########################
    #### GLOBAL DIRECTIVES ####
    ###########################
    
    #
    # Use traditional timestamp format.
    # To enable high precision timestamps, comment out the following line.
    #
    $ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat
    
    # Filter duplicated messages
    $RepeatedMsgReduction on
    
    #
    # Set the default permissions for all log files.
    #
    $FileOwner root
    $FileGroup adm
    $FileCreateMode 0640
    $DirCreateMode 0755
    $Umask 0022
    $PrivDropToUser root
    $PrivDropToGroup root
    :msg, contains, "kube-probe"  ~
    :msg, contains, "healthz"  ~
    :msg, contains, "blank"  ~
    :msg, contains, "internal/health"  ~
    :msg, contains, "GET /login"  ~
    :msg, contains, "GET /v1.0/jobs"  ~
    :msg, contains, "RESPONSE"  ~
    :msg, contains, "Missing Authorization header" ~
    $outchannel log_rotation,/var/log/syslog, 5000000,/bin/rm /var/log/syslog
    *.* :omfile:$log_rotation
    
    ######                
    
    ###### 

    ###

